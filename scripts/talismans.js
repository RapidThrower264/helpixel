var talisman_info = {'farming_talisman': {'name': 'Farming Talisman', 'rarity': 'Common', 'description': 'Increases your ✦\u2009Speed by +10% while in the Farm, Barn, and Mushroom Desert', 'craft': '5 Hay Bales, 4 Seeds', 'expected': 'null', 'total': 'null'},
         'vaccine_talisman': {'name': 'Vaccine Talisman', 'rarity': 'Common', 'description': 'Provides immunity to Poison damage when held', 'craft': '9 Poisonous Potatoes', 'expected': 'null', 'total': 'null'},
         'farmer_orb': {'name': 'Farmer Orb', 'rarity': 'Uncommon', 'description': 'Increases the regrowth rate of nearby crops on the public islands, regrowing an extra crop every 3 seconds', 'craft': '8 Enchanted Pumpkins, 1 Enchanted Glowstone', 'expected': 'null', 'total': 'null'},
         'night_vision_charm': {'name': 'Night Vision Charm', 'rarity': 'Common', 'description': 'Grants Night Vision I while this item is in your inventory.', 'craft': '4 Enchanted Brown Mushrooms, 4 Enchanted Red Mushrooms', 'expected': 'null', 'total': 'null'},
         'speed_talisman': {'name': 'Speed Talisman', 'rarity': 'Common', 'description': 'Gives +1 ✦\u2009Speed when held.', 'craft': '144 Sugar Cane', 'expected': 'null', 'total': 'null'},
         'speed_ring': {'name': 'Speed Ring', 'rarity': 'Uncommon', 'description': 'Gives +3 ✦\u2009Speed when held.', 'craft': '1 Speed Ring, 96 Enchanted Sugar', 'expected': 'null', 'total': 'null'},
         'speed_artifact': {'name': 'Speed Artifact', 'rarity': 'Rare', 'description': 'Gives +5 ✦\u2009Speed when held.', 'craft': '1 Speed Ring, 48 Enchanted Sugar Cane', 'expected': 'null', 'total': 'null'},
         'feather_talisman': {'name': 'Feather Talisman', 'rarity': 'Common', 'description': 'Increases how high you can fall without taking fall damage by 5 blocks.', 'craft': '108 Feathers', 'expected': 'null', 'total': 'null'},
         'feather_ring': {'name': 'Feather Ring', 'rarity': 'Uncommon', 'description': 'Increases how high you can fall without taking fall damage by 7 blocks and reduces fall damage by 10%.', 'craft': '1 Feather Talisman, 7 Enchanted Feathers', 'expected': 'null', 'total': 'null'},
         'feather_artifact': {'name': 'Feather Artifact', 'rarity': 'Rare', 'description': 'Increases how high you can fall without taking fall damage by 10 blocks and reduces fall damage by 15.0%.', 'craft': '1 Feather Ring, 128 Enchanted Feathers', 'expected': 'null', 'total': 'null'},
         'piggy_bank': {'name': 'Piggy Bank', 'rarity': 'Uncommon', 'description': 'Saves your coins when you die when in the player inventory', 'craft': '40 Enchanted Pork, 1 Chest', 'expected': 'null', 'total': 'null'},
         'talisman_potion_affinity': {'name': 'Potion Affinity Talisman', 'rarity': 'Common', 'description': 'Increases the duration of any consumed Potion by 10% when held in your inventory.', 'craft': '144 Nether Wart', 'expected': 'null', 'total': 'null'},
         'ring_potion_affinity': {'name': 'Potion Affinity Ring', 'rarity': 'Uncommon', 'description': 'Increases the duration of any consumed Potion by 25% when held in your inventory.', 'craft': '1 Potion Affinity Talisman, 8 Enchanted Nether Wart', 'expected': 'null', 'total': 'null'},
         'artifact_potion_affinity': {'name': 'Potion Affinity Artifact', 'rarity': 'Rare', 'description': 'Increasing the duration of any consumed Potion by 50% when held in inventory.', 'craft': '1 Potion Affinity Ring, 256 Enchanted Nether Wart', 'expected': 'null', 'total': 'null'},
         'haste_ring': {'name': 'Haste Ring', 'rarity': 'Rare', 'description': 'Gives Haste I for 15 Seconds when mining any block.', 'craft': '256 Enchanted Cobblestone', 'expected': 'null', 'total': 'null'},
         'experience_artifact': {'name': 'Experience Artifact', 'rarity': 'Epic', 'description': 'Increase experience orbs you gain by 25% while this item is in your inventory.', 'craft': '9 Enchanted Lapis Blocks', 'expected': 'null', 'total': 'null'},
         'coin_talisman': {'name': 'Talisman Of Coins', 'rarity': 'Common', 'description': 'Coins start appearing around you on public islands. Lucky!', 'craft': '20 Emeralds, 5 Gold', 'expected': 'null', 'total': 'null'},
         'magnetic_talisman': {'name': 'Magnetic Talisman', 'rarity': 'Uncommon', 'description': 'Increases item pickup range by 3x.', 'craft': '128 Emeralds, 32 Redstone', 'expected': 'null', 'total': 'null'},
         'night_crystal': {'name': 'Night Crystal', 'rarity': 'Rare', 'description': 'Increases your ❁\u2009Strength and ❈\u2009Defense by +5 during the Night.', 'craft': '1 Enchanted Quartz Block, 4 Enchanted Quartz', 'expected': 'null', 'total': 'null'},
         'day_crystal': {'name': 'Day Crystal', 'rarity': 'Rare', 'description': 'Increases your ❁\u2009Strength and ❈\u2009Defense by +5 during the Day.', 'craft': '1 Enchanted Quartz Block, 4 Enchanted Quartz', 'expected': 'null', 'total': 'null'},
         'gravity_talisman': {'name': 'Gravity Talisman', 'rarity': 'Uncommon', 'description': 'Gives between +1 and +10 ❁\u2009Strength and ❈\u2009Defense the closer you are to the Spawn of an island.', 'craft': '144 Obsidian', 'expected': 'null', 'total': 'null'},
         'fire_talisman': {'name': 'Fire Talisman', 'rarity': 'Common', 'description': 'Provides immunity to fire while held in the inventory.', 'craft': '9 Enchanted Blaze Powder', 'expected': 'null', 'total': 'null'},
         'lava_talisman': {'name': 'Lava Talisman', 'rarity': 'Uncommon', 'description': 'Provides immunity to Lava while held in the inventory.', 'craft': '9 Enchanted Magma Cream', 'expected': 'null', 'total': 'null'},
         'wood_talisman': {'name': 'Wood Affinity Talisman', 'rarity': 'Uncommon', 'description': 'Increases ✦\u2009Speed by 10% in Forest, Graveyard, Wilderness', 'craft': '1 Enchanted Log, 8 Oak Leaves', 'expected': 'null', 'total': 'null'},
         'healing_talisman': {'name': 'Healing  Talisman', 'rarity': 'Common', 'description': 'Increases healing by 5.0%.', 'craft': '144 Lily Pads', 'expected': 'null', 'total': 'null'},
         'healing_ring': {'name': 'Healing Ring', 'rarity': 'Uncommon', 'description': 'Increases healing by 10%.', 'craft': '1 Healing Talisman, 4 Enchanted Lily Pads', 'expected': 'null', 'total': 'null'},
         'bait_ring': {'name': 'Bait Ring', 'rarity': 'Rare', 'description': '5.0% chance not to consume Bait', 'craft': '256 Enchanted Ink Sacks', 'expected': 'null', 'total': 'null'},
         'sea_creature_talisman': {'name': 'Sea Creature Talisman', 'rarity': 'Common', 'description': 'Take 5.0% less damage from Sea Creatures', 'craft': '18 Sponge', 'expected': 'null', 'total': 'null'},
         'sea_creature_ring': {'name': 'Sea Creature Ring', 'rarity': 'Uncommon', 'description': 'Take 10.0% less damage from Sea Creatures', 'craft': '1 Sea Creature Ring, 2 Enchanted Sponge, 6 Sponge', 'expected': 'null', 'total': 'null'},
         'sea_creature_artifact': {'name': 'Sea Creature Artifact', 'rarity': 'Rare', 'description': 'Take 15.0% less damage from Sea Creatures', 'craft': '1 Sea Creature Ring, 64 Enchanted Sponge', 'expected': 'null', 'total': 'null'},
         'personal_compactor_4000': {'name': 'Personal Compactor 4000', 'rarity': 'Uncommon', 'description': 'Automatically turns certain materials in your inventory into their enchanted form.', 'craft': '1 Super Compactor 3000, 7 Enchanted Redstone Blocks', 'expected': 'null', 'total': 'null'},
         'personal_compactor_5000': {'name': 'Personal Compactor 5000', 'rarity': 'Rare', 'description': 'Automatically turns certain materials in your inventory into their enchanted form.', 'craft': '1 Personal Compactor 4000, 14 Enchanted Redstone Blocks', 'expected': 'null', 'total': 'null'},
         'personal_compactor_6000': {'name': 'Personal Compactor 6000', 'rarity': 'Epic', 'description': 'Automatically turns certain materials in your inventory into their enchanted form.', 'craft': '1 Personal Compactor 5000, 28 Enchanted Redstone Blocks', 'expected': 'null', 'total': 'null'},
         'zombie_talisman': {'name': 'Zombie Talisman', 'rarity': 'Common', 'description': 'Reduce the damage taken from zombies by 5%.', 'craft': 'Purchased At Adventurer NPC for 500 Coins', 'expected': 'null', 'total': 'null'},
         'skeleton_talisman': {'name': 'Skeleton Talisman', 'rarity': 'Common', 'description': 'Reduce the damage taken from skeletons by 5%.', 'craft': 'Purchased At Adventurer NPC for 500 Coins', 'expected': 'null', 'total': 'null'},
         'village_talisman': {'name': 'Village Affinity Talisman', 'rarity': 'Common', 'description': 'Increases your ✦\u2009Speed by +10% while held in the Village', 'craft': 'Purchased At Adventurer NPC for 2500 Coins', 'expected': 'null', 'total': 'null'},
         'mine_talisman': {'name': 'Mine Affinity Talisman', 'rarity': 'Common', 'description': "Increases your ✦\u2009Speed by +10% while held in the Coal Mine, Gold Mine, Deep Caverns, Gunpowder Mines, Lapis Quarry, Pigmen's Den, Slimehill, Diamond Reserve, and Obsidian Sanctuary", 'craft': 'Purchased At Adventurer NPC for 2500 Coins', 'expected': 'null', 'total': 'null'},
         'intimidation_talisman': {'name': 'Intimidation Talisman', 'rarity': 'Common', 'description': 'Level 1 monsters will no longer target you.', 'craft': 'Purchased At Adventurer NPC for 2500 Coins', 'expected': 'null', 'total': 'null'},
         'scavenger_talisman': {'name': 'Scavenger Talisman', 'rarity': 'Common', 'description': 'Monsters drop coins when killed.', 'craft': 'Purchased At Adventurer NPC for 2500 Coins', 'expected': 'null', 'total': 'null'},
         'party_hat_crab': {'name': 'Crab Hat Of Celebration', 'rarity': 'Common', 'description': '+1 ✎\u2009Int per SkyBlock year played.', 'craft': 'Party Time Event', 'expected': 'null', 'total': 'null', "file_type": "gif"},
         'new_year_cake_bag': {'name': 'New Year Cake Bag', 'rarity': 'Uncommon', 'description': 'Holds New Year Cake. Each unique New Year Cake within this bag grants +1 ❤\u2009Health.', 'craft': 'New Year Celebration Event', 'expected': 'null', 'total': 'null'},
         'bat_ring': {'name': 'Bat Ring', 'rarity': 'Epic', 'description': '+3 ❤\u2009HP, +2 ✦\u2009Speed, +2 ✎\u2009Intelligence', 'craft': 'Purchased At Fear Monger NPC for 1 Bat Talisman, 64 Green Candy', 'expected': 'null', 'total': 'null', 'file_type': 'png'},
         'bat_artifact': {'name': 'Bat Artifact', 'rarity': 'Legendary', 'description': '+5 ❤\u2009HP, +3 ✦\u2009Speed, +3 ✎\u2009Intelligence', 'craft': 'Purchased At Fear Monger NPC for 1 Bat Ring, 64 Purple Candy', 'expected': 'null', 'total': 'null'},
         'candy_talisman': {'name': 'Candy Talisman', 'rarity': 'Uncommon', 'description': 'Increases the chance for mobs to drop Candy by 5% during the Spooky Festival.', 'craft': 'Purchased At Fear Monger NPC for 16 Green Candy', 'expected': 'null', 'total': 'null'},
         'candy_ring': {'name': 'Candy Ring', 'rarity': 'Rare', 'description': 'Increases the chance for mobs to drop Candy by 10% during the Spooky Festival.', 'craft': 'Purchased At Fear Monger NPC for 1 Candy Talisman, 64 Green Candy', 'expected': 'null', 'total': 'null'},
         'candy_artifact': {'name': 'Candy Artifact', 'rarity': 'Epic', 'description': 'Increases the chance for mobs to drop Candy by 15% during the Spooky Festival.', 'craft': 'Purchased At Fear Monger NPC for 1 Candy Ring, 32 Purple Candy', 'expected': 'null', 'total': 'null'},
         'intimidation_ring': {'name': 'Intimidation Ring', 'rarity': 'Uncommon', 'description': 'Monsters at or below level 5 will no longer target you.', 'craft': 'Purchased At Fear Monger NPC for 1 Intimidation Talisman, 100 Green Candy', 'expected': 'null', 'total': 'null'},
         'intimidation_artifact': {'name': 'Intimidation Artifact', 'rarity': 'Rare', 'description': 'Monsters at or below level 25 will no longer target you.', 'craft': 'Purchased At Fear Monger NPC for 1 Intimidation Ring, 100 Purple Candy', 'expected': 'null', 'total': 'null'},
         'potato_talisman': {'name': 'Potato Talisman', 'rarity': 'Common', 'description': 'Gives +1 ✦\u2009Speed and increases Potato Minion speed by 5% while you are on your island.', 'craft': 'Talk to Potato King NPC', 'expected': 'null', 'total': 'null'},
         'bat_talisman': {'name': 'Bat Talisman', 'rarity': 'Rare', 'description': '+1 ❤\u2009HP+1 ✦\u2009Spd +1 ✎\u2009Int', 'craft': 'Rare Drop from Bats (Bats spawn on a Roofed Forest Island)', 'expected': '3', 'total': '163'},
         'spider_talisman': {'name': 'Spider Talisman', 'rarity': 'Uncommon', 'description': 'Reduces Spider, Cave Spider and Silverfish damage by 5%', 'craft': "Kill Brood Mother in Spider's Den", 'expected': '1', 'total': '1'},
         'fish_affinity_talisman': {'name': 'Fish Affinity Talisman', 'rarity': 'Rare', 'description': '5.0% faster catch time', 'craft': 'Kill Water Hydra', 'expected': 'Unknown', 'total': 'Unknown'},
         'wolf_talisman': {'name': 'Wolf Talisman', 'rarity': 'Common', 'description': 'Reduces the damage taken from Wolves by 5%.', 'craft': 'Kill Old Wolves', 'expected': '1', 'total': '200'},
         'tarantula_talisman': {'name': 'Tarantula Talisman', 'rarity': 'Epic', 'description': 'Every 10th melee hit on the same enemy deals +10% damage.', 'craft': 'Kill Tarantula Broodfather Tier 3 or 4', 'expected': '< 1%', 'total': 'null'},
         'zombie_ring': {'name': 'Zombie Ring', 'rarity': 'Uncommon', 'description': 'Reduces the damage taken by Zombies by 10%', 'craft': '1 Zombie Talisman, 64 Revenant Flesh', 'expected': 'null', 'total': 'null'},
         'devour_ring': {'name': 'Devour Ring', 'rarity': 'Rare', 'description': 'Heal 5 ❤\u2009HP when killing a monster. Cooldown: 0.5s', 'craft': '39 Revenant Viscera, 8 Enchanted Salmon, 2 Enchanted Raw Chicken', 'expected': 'null', 'total': 'null'},
         'zombie_artifact': {'name': 'Zombie Artifact', 'rarity': 'Rare', 'description': 'Reduces the damage taken by Zombies by 15%', 'craft': '48 Revenant Viscera, 32 Enchanted Iron, 16 Enchanted Diamonds', 'expected': 'null', 'total': 'null'},
         'spider_ring': {'name': 'Spider Ring', 'rarity': 'Rare', 'description': 'Reduces the damage taken from Spiders and Cave Spiders by 10%', 'craft': '1 Spider Talisman, 64 Tarantula Web', 'expected': 'null', 'total': 'null'},
         'spider_artifact': {'name': 'Spider Artifact', 'rarity': 'Epic', 'description': 'Reduces the damage taken from Spiders and Cave Spiders by 15%', 'craft': '1 Spider Ring, 32 Tarantula Silk, 32 Enchanted Emeralds', 'expected': 'null', 'total': 'null'},
         'survivor_cube': {'name': 'Survior Cube', 'rarity': 'Rare', 'description': 'Heals are +5% more effective on you', 'craft': 'Rewarded after reaching Spider Slayer 7', 'expected': 'null', 'total': 'null'},
         'red_claw_talisman': {'name': 'Red Claw Talisman', 'rarity': 'Uncommon', 'description': '☠\u2009Crit Damage +1%', 'craft': '8 Wolf Teeth, 1 Enchanted Bone', 'expected': 'null', 'total': 'null'},
         'red_claw_ring': {'name': 'Red Claw Ring', 'rarity': 'Rare', 'description': '☠\u2009Crit Damage +3%', 'craft': '1 Red Claw Talisman, 8 Golden Teeth, 32 Enchanted Leather', 'expected': 'null', 'total': 'null'},
         'red_claw_artifact': {'name': 'Red Claw Artifact', 'rarity': 'Epic', 'description': '☠\u2009Crit Damage +5%', 'craft': '1 Red Claw Ring, 54 Golden Teeth, 128 Enchanted Leather', 'expected': 'null', 'total': 'null'},
         'hunter_talisman': {'name': 'Hunter Talisman', 'rarity': 'Uncommon', 'description': "Gain +2% Combat XP from monster kills. <strong>Doesn't Upgrade to Hunter Ring</strong>", 'craft': '64 Golden Teeth, 32 Enchanted Rotten Flesh', 'expected': 'null', 'total': 'null'},
         'hunter_ring': {'name': 'Hunter Ring', 'rarity': 'Rare', 'description': "Gain +5% Combat XP from monster kills. <strong>Doesn't Upgrade to Hunter Ring</strong>", 'craft': '1 Grizzly Bait, 256 Golden Teeth', 'expected': 'null', 'total': 'null'},
         'pigs_foot': {'name': 'Pigs Foot', 'rarity': 'Rare', 'description': 'Gives +1 ✦\u2009Speed', 'craft': 'Complete Races in the End', 'expected': 'null', 'total': 'null'},
         'wolf_paw': {'name': 'Wolf Paw', 'rarity': 'Uncommon', 'description': 'Gives +1 ✦\u2009Speed', 'craft': 'Complete Races in the Woods', 'expected': 'null', 'total': 'null'},
         'campfire_badge': {'name': 'Campfire Talisman', 'rarity': 'variable_rarity', 'description': 'Heals 2-60 ❤\u2009HP per second while burning', 'craft': 'Complete Fire Trials in The Woods', 'expected': 'null', 'total': 'null', 'file_type': 'gif'},
         'wedding_ring': {'name': 'Wedding Ring', 'rarity': 'variable_rarity', 'description': 'Grants 1 in (1000000000000 to 100) chance to deal +100% damage', 'craft': "Complete Romero's Quest", 'expected': 'null', 'total': 'null', 'file_type': 'gif'},
         'melody_hair': {'name': "Melody's Hair", 'rarity': 'Epic', 'description': '+6 ✎\u2009Intelligence', 'craft': 'Complete Harp Songs in the Park', 'expected': 'null', 'total': 'null'},
         'shady_ring': {'name': 'Shady Ring', 'rarity': 'Uncommon', 'description': 'Get 1% off in most shops', 'craft': 'By at least 5 items from the Dark Auction. Talisman Price: 500k Coins', 'expected': 'null', 'total': 'null'},
         'crooked_artifact': {'name': 'Crooked Artifact', 'rarity': 'Rare', 'description': 'Get 2% off in most shops', 'craft': 'By at least 5 items from the Dark Auction. Talisman Price: Shady Ring + 2M Coins', 'expected': 'null', 'total': 'null'},
         'seal_of_the_family': {'name': 'Seal Of The Family', 'rarity': 'Epic', 'description': 'Get 3% off in most shops', 'craft': 'By at least 15 items from the Dark Auction. Talisman Price: Crooked Artifact + 10M Coins', 'expected': 'null', 'total': 'null'},
         'frozen_chicken': {'name': 'Frozen Chicken', 'rarity': 'Rare', 'description': 'Give +1 ✦\u2009Speed', 'craft': 'Complete Checkpoint 3 in Chicken Race', 'expected': 'null', 'total': 'null'},
         'cat_talisman': {'name': 'Cat Talisman', 'rarity': 'Uncommon', 'description': 'Gives +1 ✦\u2009Speed', 'craft': 'Get 4/4 in 1 dungeon hub race location', 'expected': 'null', 'total': 'null'},
         'lynx_talisman': {'name': 'Lynx Talisman', 'rarity': 'Rare', 'description': 'Gives +2 ✦\u2009Speed', 'craft': 'Get 4/4 in 2 dungeon hub race locations', 'expected': 'null', 'total': 'null'},
         'cheetah_talisman': {'name': 'Cheetah Talisman', 'rarity': 'Epic', 'description': 'Gives +3 ✦\u2009Speed', 'craft': 'Get 4/4 in 3 dungeon hub race locations', 'expected': 'null', 'total': 'null'},
         'scarf_studies': {'name': "Scarf's Studies", 'rarity': 'Rare', 'description': 'Gain Dungeon Class experience 2% faster', 'craft': 'Obtained from Catacombs Floor 2 Chests', 'expected': 'unknown', 'total': 'unknown'},
         'scarf_thesis': {'name': 'Scarfs Thesis', 'rarity': 'Epic', 'description': 'Gain Dungeon Class experience 4% faster', 'craft': "4 Scarf's Studies", 'expected': 'null', 'total': 'null'},
         'scarf_grimoire': {'name': 'Scarfs Grimoire', 'rarity': 'Legendary', 'description': 'Gain Dungeon Class experience 6% faster', 'craft': "4 Scarf's Thesis", 'expected': 'null', 'total': 'null'},
         'treasure_talisman': {'name': 'Treasure Talisman', 'rarity': 'Rare', 'description': 'Grants +1% extra loot to end of dungeon chests.', 'craft': 'Found in Dungeon Secrets', 'expected': 'unknown', 'total': 'unknown'},
         'treasure_ring': {'name': 'Treasure Ring', 'rarity': 'Epic', 'description': 'Grants +2% extra loot to end of dungeon chests.', 'craft': '8 Treasure Talismans', 'expected': 'null', 'total': 'null'},
         'treasure_artifact': {'name': 'Treasure Artifact', 'rarity': 'Legendary', 'description': 'Grants +3% extra loot to end of dungeon chests.', 'craft': '9 Treasure Rings', 'expected': 'null', 'total': 'null'},
         'wolf_ring': {'name': 'Wolf Ring', 'rarity': 'Rare', 'description': 'Reduces the damage taken from Wolves by 10%.', 'craft': '1 Wolf Talisman, 1 Weak Wolf Catalyst, 14 Enchanted Bones', 'expected': 'null', 'total': 'null'},
         'ender_artifact': {'name': 'Ender Artifact', 'rarity': 'Epic', 'description': 'Reduces the damage taken from Endermen, Ender Dragons and Endermites by 20%', 'craft': 'Purchase from Dark Auction', 'expected': 'null', 'total': 'null'},
         'wither_artifact': {'name': 'Wither Artifact', 'rarity': 'Epic', 'description': 'Reduces the damage taken from Withers by 20%', 'craft': 'Purchase from Dark Auction', 'expected': 'null', 'total': 'null'}};

function generateAllTalismanButtons() {  // generates all the talismans to be presented to the user
  var talisman_info_sorted = {};

  var talisman_keys = ["bait_ring", "bat_talisman", "bat_ring", "bat_artifact",  "campfire_badge", "candy_talisman", "candy_ring", "candy_artifact", "cat_talisman", "lynx_talisman", "cheetah_talisman", "coin_talisman", "shady_ring", "crooked_artifact", "seal_of_the_family", "day_crystal", "night_crystal", "devour_ring", "ender_artifact", "experience_artifact", "farmer_orb", "farming_talisman", "feather_talisman", "feather_ring", "feather_artifact", "fire_talisman", "fish_affinity_talisman", "frozen_chicken", "gravity_talisman", "haste_ring", "healing_talisman", "healing_ring", "hunter_talisman", "hunter_ring", "intimidation_talisman", "intimidation_ring", "intimidation_artifact", "lava_talisman",  "magnetic_talisman", "melody_hair", "mine_talisman", "new_year_cake_bag", "night_vision_charm", "party_hat_crab", "personal_compactor_4000", "personal_compactor_5000", "personal_compactor_6000", "piggy_bank", "pigs_foot", "potato_talisman", "talisman_potion_affinity", "ring_potion_affinity", "artifact_potion_affinity", "red_claw_talisman", "red_claw_ring", "red_claw_artifact",   "scarf_studies", "scarf_thesis", "scarf_grimoire", "scavenger_talisman", "sea_creature_talisman", "sea_creature_ring", "sea_creature_artifact", "skeleton_talisman", "speed_talisman", "speed_ring", "speed_artifact", "spider_talisman", "spider_ring", "spider_artifact", "survivor_cube", "tarantula_talisman", "treasure_talisman", "treasure_ring", "treasure_artifact", "vaccine_talisman", "village_talisman", "wedding_ring", "wither_artifact", "wolf_paw", "wolf_talisman", "wolf_ring", "wood_talisman" ,"zombie_talisman", "zombie_ring", "zombie_artifact"]

  for (i = 0; i < talisman_keys.length; i++) {
    talisman_info_sorted[talisman_keys[i]] = talisman_info[talisman_keys[i]];
  }

  talisman_info = talisman_info_sorted;

  for (var key in talisman_info) {
    createButton(key, talisman_info[key]["name"], talisman_info[key]["rarity"]);  // creates a clickable button
  }
}

function createButton(image_id, cute_name, rarity) {
  var image_id = image_id.replace(/ /g, "_");
  var button = $('<button><h3>'+ cute_name + '</h3></button>').attr({
            'onclick': 'displayContent(this)',
            'class': "accessory-box",
            'id': image_id + "_button"
          }).appendTo("#accessories-scroll");  // creates the button which users can see.
  var image_style_id = "";

  if (talisman_info[image_id]["file_type"]) {  // tests if the image supposed to be presented is supposed to be another format other than png
    var src = image_id + "." + talisman_info[image_id]["file_type"];
  }
  else {
    var src = image_id + ".png";
  }

   var img = $('<img />').attr({
     'src': 'assets/images/talisman_images/' + src,
     'onerror': "this.onerror=null; this.src='assets/images/talisman_images/image_not_found.png'",
     'class': 'talisman-img ' + rarity.toLowerCase(),
     'title': cute_name
   }).appendTo("#" + image_id + "_button"); // creates an image and adds it to the previously added button
  }

function displayContent(item) { // displaying information of the clicked talisman
  var itemTitle = item.children[1].src.split("/");
  itemTitle = talisman_info[itemTitle[itemTitle.length - 1].split(".")[0]];

  document.getElementById("accessory-title").innerHTML = itemTitle["name"];
  if (itemTitle["rarity"] == "variable_rarity") {
    document.getElementById("accessory-rarity").innerHTML = "Has multiple rarities ranging from Common To Legendary";
  }
  else {
    document.getElementById("accessory-rarity").innerHTML = itemTitle["rarity"];
  }
  document.getElementById("accessory-img").src = item.children[1].src;
  document.getElementById("accessory-img").className = "large-talisman-img " + itemTitle["rarity"].toLowerCase();

  document.getElementById("accessory-description").innerHTML = itemTitle["description"];

  if (!isNaN(itemTitle["craft"][0])) { // tests if the first character of the string is number
    document.getElementById("obtain-method").innerHTML = "Crafting: ";
  }
  else {
    document.getElementById("obtain-method").innerHTML = "Obtaining: ";
  }
  document.getElementById("items-area").innerHTML = itemTitle["craft"];

  if (itemTitle["expected"] == 'null') {
    document.getElementById("drop-chance-fraction").innerHTML = " (Not Mob Drop)";
    document.getElementById("drop-chance-percent").innerHTML = "";
  }
  else {
    var top = itemTitle["expected"];
    var bottom = itemTitle["total"];
    document.getElementById("drop-chance-fraction").innerHTML = " (" + top + " / " + bottom + ")";
    document.getElementById("drop-chance-percent").innerHTML = (top / bottom).toPrecision(3) + "%";
  }
}

function searchPlayer() {  // searches for a specific player supplied by the user
  var playerName = document.getElementById("playerName").value;  // gets the user entered name

  var playerProfileRequest = new XMLHttpRequest();  // create request to API
  playerProfileRequest.open('GET', 'https://api.slothpixel.me/api/skyblock/profiles/' + playerName, true);
  playerProfileRequest.onload = function() {
    var data = JSON.parse(this.response);  // get data back from query
    if (data["error"] != null) {
      // entered name doesn't have a skyblock profile
      alert(playerName + " does not have a skyblock profile\nPlease check that you have inputted it correctly");
    }
    else {
      // continue processing data
      var profileID = Object.keys(data); // gets all the profile ids

      var selectBox = document.getElementById("profile-select");
      for (option = selectBox.length - 1; option >= 1; option--) {
        selectBox.remove(option); // remove existing options besides the blank one
      }
      for (i = 0; i < profileID.length; i++) {
        let newOption = new Option(data[profileID[i]]['cute_name'], playerName + ' ' + profileID[i]);
        selectBox.add(newOption, undefined);  // adds option to the drop down
      }

      document.getElementById("profile-select").disabled = false;
      document.getElementById("profile-select").style.background = "#55FF55";
      setTimeout(function() {
        document.getElementById("profile-select").style.background = "white";
      }, 1000);
    }
  }
  playerProfileRequest.send();  // run request
}

function userEntryChange() {
  document.getElementById("profile-select").disabled = true;
  document.getElementById("profile-select").selectedIndex = 0;
}

function showOwnedTalismans() {  // displays talismans to the user in each respective box
  var items = document.getElementById("profile-select").value.split(" ");
  if (items.length == 2) {  // tests if the option selected isn't blank
    var request = new XMLHttpRequest();  // create API Request
    request.open('GET', 'https://api.slothpixel.me/api/skyblock/profile/' + items[0] + '/' + items[1], true);

    request.onload = function () {
      // Begin accessing JSON data here
      var data = JSON.parse(this.response);
      var members = Object.keys(data['members']);

      // loop to iterate through members to find the user supplied
      for (i = 0; i < members.length; i++) {
        if (data['members'][members[i]]['player']['username'] == items[0]) {
          uuid = data['members'][members[i]]['player']['uuid']; // gets the uuid of the player
          break;
        }
      }

      var talismans = data['members'][uuid]['talisman_bag'];  // gets all the talismans in the users talisman bag
      if (talismans.length > 0) {  // tests if the user's api settings are enabled

        var index = 0;
        resetButtonColours();
        talismans.forEach(item => {
          try {
            var owned_talisman = item["attributes"]["id"].toLowerCase();
            if (owned_talisman.includes("wedding")) { owned_talisman = "wedding_ring";}
            else if (owned_talisman.includes("campfire")) { owned_talisman = "campfire_badge";}
            document.getElementById(owned_talisman + "_button").className += " owned-talisman";
          }
          catch {}
        });
      }
      else {
        alert("This profile does not have Inventory Settings Enabled \n" +
        "Go into skyblock menu > Settings > API Settings and turn Inventory On");  // if the user doesn't have inventory enabled
        document.getElementById("profile-select").selectedIndex = 0;
      }
    }
    request.send();
  }
}

function resetButtonColours() {
  var box = document.getElementById("accessories-scroll").childNodes;
  for (i = 0; i < box.length; i++) {
    if (box[i].nodeName.toLowerCase() == 'button') {
      box[i].className = "accessory-box"; // "deselects" all talismans that the previous user has owned
    }
  }
}
